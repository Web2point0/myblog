<!DOCTYPE html>
<html>
<head>
  <title>PeerJS Manual Connect Video Chat</title>
  <style>
    body { font-family: sans-serif; text-align: center; background: #111; color: #fff; }
    video { width: 45%; border-radius: 10px; margin: 10px; }
    #peer-id { margin: 10px; font-weight: bold; }
    input, button { padding: 8px; margin: 5px; }
    #red { color: red; }
  </style>
  <link rel="stylesheet" href="">
</head>
<body>
  <h2>One on One Video Chat (Manual Connect)</h2>
  <div id="peer-id">Connecting to PeerJS...</div>
  <input id="remoteId" placeholder="Enter partner ID" />
  <button id="connectBtn">Connect</button>
  <br>
  
  <div id="red">
  <p>This is a free limited bandwithed webRTC relay using STUN ICE Servers, utilizing the metered turn servers and the community STUN servers at 0.peerjs.com.</p>
  <p>Be generous with your time as this is not meant for long-term communication.</p>
  </div>
  <p>How to use: Have both participants visit: https://myyear.net/1on1 for use with a DESKTOP otherwise proceed to this <a href="https://myyear.net/mobile/">link for mobile video chat.</a> Have either you or the other user copy the Peer ID eg)Z0101234-X4120-1A02-Z123-0012301X0123. Paste that into the PeerID field and click Connect. It will establish a secure tunnel between your webcam and the other webcam if both participants are currently active on the browser url link otherwise it will timeout and you need to reConnect again.  </p>
  
  
  <video id="myVideo" autoplay muted></video>
  <video id="remoteVideo" autoplay></video>

  <script src="https://unpkg.com/peerjs@1.5.2/dist/peerjs.min.js"></script>
  <script>
    const iceServers = [
      {
        urls: [
          "stun:stun.metered.ca:80",
          "turn:turn.metered.ca:80",
          "turn:turn.metered.ca:443?transport=tcp",
          "turns:turn.metered.ca:443?transport=tcp"
        ],
        username: "a1b6372ba64416abdabd7b44",
        credential: "do1BGC+KPZA6pmdF"
      }
    ];

    const peer = new Peer({
      host: "0.peerjs.com",
      port: 443,
      secure: true,
      config: { iceServers }
    });

    const myVideo = document.getElementById("myVideo");
    const remoteVideo = document.getElementById("remoteVideo");
    const peerIdDisplay = document.getElementById("peer-id");
    const connectBtn = document.getElementById("connectBtn");
    const remoteIdInput = document.getElementById("remoteId");

    let myStream;

    peer.on("open", id => {
      peerIdDisplay.innerText = "Your Peer ID: " + id;
      console.log("My Peer ID:", id);
    });

    navigator.mediaDevices.getUserMedia({ video: true, audio: true })
      .then(stream => {
        myStream = stream;
        myVideo.srcObject = stream;
      });

    connectBtn.onclick = () => {
      const remoteId = remoteIdInput.value;
      if (!remoteId) return alert("Enter a partner ID");
      const call = peer.call(remoteId, myStream);
      call.on("stream", remoteStream => remoteVideo.srcObject = remoteStream);
    };

    peer.on("call", call => {
      call.answer(myStream);
      call.on("stream", remoteStream => remoteVideo.srcObject = remoteStream);
    });
  </script>
</body>
</html>
